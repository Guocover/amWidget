define(function(t,e,n){"use strict";function r(t){return t=parseInt(t),t%4==0&&t%100!=0||t%400==0}function i(t,e,n){for(var r=[],i=t;e>=i;i++)r.push({name:i+n,value:i});return r}function a(t,e){var n=r(t);e=parseInt(e);var i=[31,28,31,30,31,30,31,31,30,31,30,31];return 2==e&&n?29:i[e-1]}function s(t,e){var n={Y:t.getYear(),y:t.getYear(),M:t.getMonth(),m:t.getMonth(),D:t.getDay(),d:t.getDay()};return e.replace(/([YyMmDd])+/g,function(t,e){switch(e){case"y":return n[e].toString().slice(-t.length);case"Y":return n[e].toString().slice(-t.length);default:return((t.length>1?"0":"")+n[e]).slice(-2)}})}var l=function(t){if(this.container=t.container,!this.container)return!1;var e=new Date;this.defaultDate=t.defaultDate||{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()},this.min_date={year:1980,month:1,day:1},this.max_date={year:2025,month:12,day:31},this._initScrollers(),this.select(this.defaultDate)};l.prototype={_initScrollers:function(){var t=this,e=this.defaultDate,n=a(e.year,e.month);this.yearScroller=new T({id:"year-scroller",container:this.container,data:i(t.min_date.year,t.max_date.year,"年"),selectedCallback:function(e,n){if(e!=n){var s=r(e),l=r(n);if(s!=l){var o=t.monthScroller,c=t.dayScroller;e=parseInt(e),n=parseInt(n);var u=parseInt(o.getValue()),h=parseInt(c.getValue()),d=a(e,u),f=i(1,d,"日");2!=u||29!=h||s?(c.render(f),c.select(h)):(c.render(f),c.select(h-1))}}}}),this.monthScroller=new T({id:"month-scroller",container:this.container,data:i(1,12,"月"),selectedCallback:function(e,n){if(e!=n){var r=t.yearScroller.getValue(),s=a(r,e),l=a(r,n);if(s!=l){var o=i(1,s,"日"),c=t.dayScroller,u=parseInt(c.getValue());u=t._calcNearestValue(u,s,l),c.render(o),c.select(u)}}}}),this.dayScroller=new T({id:"day-scroller",container:this.container,data:i(1,n,"日")})},_calcNearestValue:function(t,e,n){return e>=n?t:t>e?e:t},select:function(t){t.year&&this.yearScroller.selectThenCallback(t.year),t.month&&this.monthScroller.selectThenCallback(t.month),t.day&&this.dayScroller.select(t.day)},getValue:function(t){if(!t)return this.getYear()+"-"+this.getMonth()+"-"+this.getDay();var e={year:this.yearScroller.getValue(),month:this.monthScroller.getValue(),day:this.dayScroller.getValue()};return e},getYear:function(){return this.yearScroller.getValue()},getMonth:function(){return this.monthScroller.getValue()},getDay:function(){return this.dayScroller.getValue()}};var o=44,c=2,u=o*c,h=3,d=200,f=1e3,v=.2,m=.1,p=o*(c+1),g="scroller-item",y='<div class="scroller-component"> 	  <div class="mask"></div> 	  <div class="current-indicator"></div> 	  <div class="scroller"></div> 	</div>',T=window.Scroller=function(t){var e=document.createElement("div");e.innerHTML=y,this.scrollerComponent=e.firstElementChild,this.scroller=this.scrollerComponent.lastElementChild,t=t||{};var n=t.container;n&&1==n.nodeType&&n.appendChild(this.scrollerComponent),t.id&&this.scrollerComponent.setAttribute("id",t.id),t.data&&this.render(t.data),this.callback=t.selectedCallback,this._resetHeight(),this.startYInMove=0,this.touch=null,this._init()};T.prototype={currentValue:null,prevValue:null,_init:function(){this._setTransitionDuratoin(v),this._bindEvents()},_bindEvents:function(){var t,e,n,r,i,a,s=this,l=this.scroller,v=this.scrollerComponent,p=this.parentHeight,g=!1;v.addEventListener("touchstart",function(e){if(e.preventDefault(),s._setTransitionDuratoin(0),g){g=!1;var n=new WebKitCSSMatrix(window.getComputedStyle(s.scroller).webkitTransform),r=n.f;r!=a&&(document.removeEventListener("webkitTransitionEnd",s.scroller,!1),s._setTransformY(r)),n=new WebKitCSSMatrix(window.getComputedStyle(s.scroller).webkitTransform)}var i=e.changedTouches[0];t=+new Date,s.startY=s.startYInMove=i.clientY,clearTimeout(s.callbackTimer)},!1),v.addEventListener("touchmove",function(t){t.preventDefault(),s.touch=t.changedTouches[0],s._setPosition()},!1),v.addEventListener("touchend",function(v){var y=v.changedTouches[0],T=+new Date,b=s._getCurrentTransitionY();if(n=b,d>T-t){e=y.clientY-s.startY;var S=Math.abs(e)/(T-t)/h;0>e?(r=Math.abs(-(s.scrollerHeight-p)-b)/S,a=-(s.scrollerHeight-p)-u):(r=Math.abs(b)/S,a=u),r>f&&(r=f,i=S*r,a=0>e?b-i:b+i),a=Math.round(a/o)*o,r/=1e3}else r=m,a=Math.round(b/o)*o;a>u?a=u:a<s.minTransitionY+o&&(a=s.minTransitionY+o),Math.abs(a-b)<u&&(r=m),g=!0,s._setTransitionDuratoin(r),s._setTransformY(a);var C=Math.abs(a/o-c),V=l.children[parseInt(C)];V&&(r=1e3*r,s.prevValue=s.currentValue,s.currentValue=V.dataset.value,"function"==typeof s.callback&&s.callback(s.currentValue,s.prevValue),s.callbackTimer=setTimeout(function(){g=!1},r)),s.touch=null},!1)},_resetHeight:function(){this.scrollerHeight=this.scroller.clientHeight,this.parentHeight=this.scrollerComponent.clientHeight,this.minTransitionY=-(this.scrollerHeight+p-this.parentHeight)},_setPosition:function(t){if(t=t||this.touch){var e=t.clientY,n=e-this.startYInMove,r=this._getCurrentTransitionY(),i=r+n;i>p?i=p:i<this.minTransitionY&&(i=this.minTransitionY),this._setTransformY(i),this.startYInMove=e}},_setTransitionDuratoin:function(t){var e="all "+t+"s ease-out";this.scroller.style.webkitTransition=e,this.scroller.style.transition=e},_setTransformY:function(t){this.scroller.style.webkitTransform=w+"(0, "+t+"px"+M},_getCurrentTransitionY:function(){var t=this.scroller.style.getPropertyCSSValue("-webkit-transform");return t?parseFloat(t[0][1].cssText):0},selectByIndex:function(t){var e=this.scroller;if(0>t||t>e.childElementCount-1)return!1;var n=u-o*t;this._setTransitionDuratoin(v),this._setTransformY(n);var r=e.children[t];this.prevValue=this.currentValue,this.currentValue=r.dataset.value},select:function(t){if(void 0===t||null===t)return this;for(var e=this.scroller.children,n=0,r=e.length;r>n;n++)if(e[n].dataset.value==t)return void this.selectByIndex(n);return this},selectThenCallback:function(t){return this.select(t),"function"==typeof this.callback&&this.callback(this.currentValue,this.prevValue),this},getValue:function(){return this.currentValue},setSelectedCallback:function(t){return this.callback=t,this},render:function(t){if(!t||0==t.length||t.constructor!==Array)return!1;var e="";return t.forEach(t[0].constructor===Object?function(t){e+='<div class="'+g+'" data-value="'+t.value+'">'+t.name+"</div>"}:function(t){e+='<div class="'+g+'" data-value="'+t+'">'+t+"</div>"}),this.scroller.innerHTML=e,this._resetHeight(),this}},window.onload=function(){var t,e,n,r=document.body,i=(document.getElementsByTagName("input"),r.querySelectorAll("input[data-type='date']"));r.style.height="auto";var a=r.clientHeight,o=window.innerHeight;if(i[0]){for(var c=i.length,u=0;c>u;u++)i[u].setAttribute("readOnly","readonly");t=document.createElement("div"),t.id="ds-container";var h=document.createElement("div");h.id="ds-optionWrapper";var d=document.createElement("span");d.id="ds-confirm",d.className="ds-btn",d.innerHTML="确定";var f=document.createElement("span");f.id="ds-cancel",f.className="ds-btn",f.innerHTML="取消",h.appendChild(f),h.appendChild(d),t.appendChild(h),document.body.appendChild(t),n=new l({container:byId("ds-container")}),t.style.display="none",r.addEventListener(Y,function(i){var l=i.target,c=l.nodeName.toUpperCase();if("INPUT"==c){var u=l.getAttribute("data-type");u&&"date"==u?(l.setAttribute("readOnly","readonly"),e=l,setTimeout(function(){t.style.display="block";var n=r.scrollTop||document.documentElement.scrollTop,i=e.offsetTop+e.offsetHeight,s=o-(i-n),l=t.offsetHeight;if(r.style.height=a+l+"px",l>=s){var c=l-s;r.scrollTop=n+c}},300)):(t.style.display="none",r.style.height=a+"px")}if("ds-confirm"==l.id){var h=n.getValue(!1),d=e.getAttribute("data-format");e.value=d?s(n,d):h,t.style.display="none",r.style.height=a+"px"}"ds-cancel"==l.id&&(t.style.display="none",r.style.height=a+"px")},!1)}};var b=/iphone/gi.test(navigator.appVersion),S=/ipad/gi.test(navigator.appVersion),C=/android/gi.test(navigator.appVersion),V=b||S||C,Y=V?"touchend":"mouseup",_=!("WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix),w=_?"translate3d":"translate",M=_?", 0)":")";n.exports=l});