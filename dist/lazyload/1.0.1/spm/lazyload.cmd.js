define(function(t,e,n){"use strict";function o(t){return Object.prototype.toString.call(t).replace(/\[object (\w+)\]/,"$1").toLowerCase()}function i(t){return-1===o(t).indexOf("element")?o(t):"element"}function r(t,e){var n=e.options.lazyAttr;t.getAttribute(n)&&(t.src=t.getAttribute(n),t.removeAttribute(n))}function c(t,e){for(var n=t.length;n--;)-1!==e.matchStack.indexOf(t[n])?t.splice(n,1):("undefined"==typeof t[n].getAttribute(e.options.lazyAttr)||""===t[n].getAttribute(e.options.lazyAttr))&&t.splice(n,1);return t}function s(t,e){var n={width:window.innerWidth,height:window.innerHeight,top:document.body.scrollTop|document.documentElement.scrollTop,left:document.body.scrollLeft|document.documentElement.scrollLeft},o=e.options.offsetPre,i={top:0,left:0,bottom:0,right:0};return"undefined"!=typeof t.getBoundingClientRect&&(i=t.getBoundingClientRect(),e.options.log&&(i.top===i.bottom&&console.warn(t,"need height"),i.left===i.right&&console.warn(t,"need width"))),e.options.overget?i.top-o<n.height&&i.left-o<n.width:i.bottom+o>=0&&i.top-o<n.height&&i.right+o>=0&&i.left-o<n.width}function a(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function d(t){try{return new Function("return "+t)()}catch(e){return{}}}var u={options:{auto:!0,offsetPre:10,lazyAttr:"data-src",overget:!1,log:!0},matchStack:[],init:function(t){var e=document.querySelector("body").getAttribute("data-lazy");if(e=d(e),this.options=a(this.options,e),this.options=a(this.options,t),this.runLock=!0,this.options.auto){var n=document.querySelectorAll("img["+this.options.lazyAttr+"]");this.load(n)}},load:function(t){this.add(t),this.addLoadListener()},add:function(t){switch(i(t)){case"element":t="htmlimageelement"===o(t)?[t]:t.querySelectorAll(this.options.lazyAttr);break;case"string":t=document.querySelectorAll(t)}t.length&&t.length>0&&(t=Array.prototype.slice.call(t),t=c(t,this),this.matchStack=this.matchStack.concat(t))},addLoadListener:function(){this.run(),this.runLock&&(this.runLock=!1,window.addEventListener("scroll",this.run,!1),window.addEventListener("resize",this.run,!1),window.addEventListener("orientchange",this.run,!1))},removeLoadListener:function(){window.removeEventListener("scroll",this.run,!1),window.removeEventListener("resize",this.run,!1),window.removeEventListener("orientchange",this.run,!1),this.runLock=!0},run:function(){var t=u.matchStack;if(0===t.length)return void u.removeLoadListener();for(var e=0;e<t.length;e++){var n=t[e];s(n,u)&&(r(n,u),t.splice(e,1),e--)}}};"complete"===document.readyState?u.init():document.addEventListener("DOMContentLoaded",function(){u.init()},!1),n.exports=u});